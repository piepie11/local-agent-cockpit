# 项目工程公约（通用默认稿）

> 用途：当某个 workspace（目标项目）**找不到其约定文件**时，`auto_codex` 会把本文件作为“默认工程公约”注入到 Manager/Executor 的提示词中。  
> 约定文件路径来自 workspace 注册的 `conventionPath`；若未配置，默认使用 `<workspaceRoot>/约定.md`。  
> 建议：把本文件复制到你的项目根目录作为 `约定.md`（或你配置的 `conventionPath` 指向的文件名），再按项目实际情况裁剪/补充（让规则成为“项目的一部分”，而不是只在编排器里生效）。

---

## 0. 角色与边界（强制）

- **Manager/评价官**：允许临场决断（拆分/合并/调整顺序/补充必要子任务），但一旦偏离计划必须要求写“决策留痕”并走 git 闭环。
- **Executor/执行者**：禁止发散；只能做 Manager 的 `INSTRUCTIONS` 明确要求的事情；任何额外探索必须先请求 Manager 授权。

> 备注：本公约只规定过程与产物口径；具体需求/里程碑以该项目的 `plan.md`（或等效计划文件）为准。

---

## 1. 五步闭环（强制，任何小点都必须完成）

一个“可独立验证的小改动/小实验”必须走完：

1) 改代码 / 改配置（只改本小点范围）  
2) 跑验证（至少 1 条可复现命令；优先快的：unit/smoke/lint）  
3) 手写留痕文档（基于结果总结，禁止整段日志 dump 充数）  
4) Git 提交（message 必须引用留痕 md 路径）  
5) 评价官复审（只审查不修改：看 `git show` + 测试/实验摘要 + 留痕结论；给 PASS/FAIL 与明确下一步）

留痕建议：
- 目录：`docs/notes/`
- 命名：`YYYY-MM-DD_HHmm_<topic>.md`
- 必须回答：做了什么、怎么验证、结果如何、决定了什么、下一步是什么

---

## 2. 目录与产物归位（强制）

- 禁止在项目根目录随手丢运行产物（`*.log/*.jsonl/*.sqlite/*.csv/*.png` 等）。
- 若项目没有既定规范，默认采用：
  - 文档/报告：`docs/`
  - 留痕：`docs/notes/`
  - 日志：`logs/`
  - 运行产物：`runs/`

---

## 3. 可复现与可回溯（强制）

每次关键运行/实验（至少在留痕 md 中）必须记录：
- `cwd` / 运行入口命令
- 关键版本信息（能取到多少写多少）：
  - Node：`node -v` / `npm -v`
  - Python：`sys.executable` / `python -V`（若项目是 Python）
  - Git：`git --version`（若项目是 git repo）
- 关键配置（若有 config 文件/环境变量/CLI 参数）

禁止静默回退：
- 非法配置/缺失文件/状态不一致：**直接报错并带上下文**（不要吞异常然后悄悄用默认值）。

优先复用，禁止造重复轮子：
- 写新代码/新脚本前先检索仓库（IDE Search / `rg` / `grep`）是否已有同类能力。
- 若已有同类实现：必须复用或抽取为**单一权威实现**（避免两套并存导致逻辑漂移）。
- 若确需新写：必须在留痕文档中写清“为什么旧实现不够用”，并明确迁移/弃用策略。

---

## 4. 安全与破坏性操作（强制）

- 禁止执行高风险破坏性命令（如全盘删除/格式化/清理系统目录）。  
- 若确需涉及删除/重置等操作：必须先在留痕中写清“为什么必须做、影响范围、回滚方式”，并由评价官明确同意后再执行。

---

## 5. 发散规则（允许探索，但要写作业）

- 允许为了最终目标做必要探索（验证假设、补齐诊断信息、对比方案）。
- 每次探索都必须配套留痕（动机/方法/结果/对主线影响），否则视为无效工作。
