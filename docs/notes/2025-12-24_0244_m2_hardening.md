# 2025-12-24_0244 — M2：Hardening（git 闭环/空跑检测 + Run options UI）

## 做了什么
- Orchestrator（`src/orchestrator/orchestrator.js`）
  - `requireGitClean`（默认 true）：每轮 Executor 结束后强制 `git status --porcelain` 为空，否则自动 PAUSE（error=`GIT_DIRTY`）
  - `noProgressLimit`（默认 3）：连续 N 轮“CHANGES 为空 + Manager 指令不变”触发 PAUSE（error=`NO_PROGRESS`）
- Prompt builder（`src/orchestrator/prompt_builder.js`）
  - 在 Manager/Executor 的 TASK 中明确要求 git micro-loop（改动->验证->提交->保持 clean）
- UI（`web/*`）
  - Create run 时可设置：`maxTurns`、`timeout(min)`、`repoDigestEnabled`、`requireGitClean`、`noProgressLimit`
  - Dashboard 显示 SSE 连接状态

## 如何验证
- `node -e "const { createServer } = require('./src/server'); const { store } = createServer(); store.close(); console.log('server load OK');"`
- （人工）`npm run dev` 后创建 run，观察：
  - dirty workspace 会触发 PAUSE + error 事件
  - 连续无 CHANGES 且 manager 不变会触发 NO_PROGRESS

## 下一步
- 最终验收：补一份“手机访问”运行手册 + 约定.md 进度更新 + 增加一个后端 e2e 脚本（不依赖浏览器）验证 Done 终止

